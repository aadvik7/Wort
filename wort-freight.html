<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wort Freight Configurator</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN TOKENS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --bg-0: #06090f;
  --bg-1: #0c1017;
  --bg-2: #111620;
  --bg-3: #171d2a;
  --bg-4: #1e2636;
  --bg-hover: #232d40;

  --border-0: #1a2235;
  --border-1: #243050;
  --border-focus: #3b82f6;

  --text-0: #f0f4f8;
  --text-1: #94a3b8;
  --text-2: #5a6a80;

  --cyan: #22d3ee;
  --blue: #3b82f6;
  --green: #10b981;
  --amber: #f59e0b;
  --red: #ef4444;
  --purple: #a78bfa;

  --mono: 'JetBrains Mono', monospace;
  --sans: 'Inter', system-ui, sans-serif;

  --r-sm: 4px;
  --r-md: 6px;
  --r-lg: 10px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESET & BASE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: var(--sans);
  background: var(--bg-0);
  color: var(--text-0);
  font-size: 13px;
  line-height: 1.55;
  -webkit-font-smoothing: antialiased;
  overflow-x: hidden;
}

::-webkit-scrollbar { width: 5px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-1); border-radius: 3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app {
  display: grid;
  grid-template-columns: 1fr 340px;
  grid-template-rows: 48px 1fr;
  height: 100vh;
}

/* â”€â”€â”€ Top Bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 20px;
  background: var(--bg-1);
  border-bottom: 1px solid var(--border-0);
  z-index: 10;
}
.topbar-brand {
  display: flex;
  align-items: center;
  gap: 10px;
}
.topbar-logo {
  width: 26px; height: 26px;
  background: linear-gradient(135deg, var(--blue), var(--cyan));
  border-radius: var(--r-sm);
  display: grid; place-items: center;
  font: 700 13px var(--mono);
  color: #fff;
}
.topbar-name { font: 700 14px var(--mono); letter-spacing: -.02em; }
.topbar-tag {
  font: 500 9px var(--mono);
  text-transform: uppercase;
  letter-spacing: .06em;
  padding: 2px 7px;
  border-radius: var(--r-sm);
  background: rgba(59,130,246,.1);
  color: var(--blue);
  border: 1px solid rgba(59,130,246,.2);
}
.topbar-status {
  font: 400 10px var(--mono);
  color: var(--text-2);
  display: flex; align-items: center; gap: 6px;
}
.topbar-dot {
  width: 6px; height: 6px;
  background: var(--green);
  border-radius: 50%;
  animation: pulse 2s infinite;
}
@keyframes pulse { 50% { opacity: .4; } }

/* â”€â”€â”€ Main Panel â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  overflow-y: auto;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 16px;
}

/* â”€â”€â”€ Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  background: var(--bg-1);
  border-left: 1px solid var(--border-0);
  overflow-y: auto;
  display: flex;
  flex-direction: column;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.card {
  background: var(--bg-2);
  border: 1px solid var(--border-0);
  border-radius: var(--r-lg);
  overflow: hidden;
}
.card-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px 16px;
  background: var(--bg-3);
  border-bottom: 1px solid var(--border-0);
}
.card-title {
  display: flex;
  align-items: center;
  gap: 10px;
  font: 600 13px var(--sans);
}
.card-icon {
  width: 26px; height: 26px;
  border-radius: var(--r-sm);
  display: grid; place-items: center;
  font-size: 13px;
}
.card-icon.bl { background: rgba(59,130,246,.12); }
.card-icon.gr { background: rgba(16,185,129,.12); }
.card-icon.am { background: rgba(245,158,11,.12); }
.card-icon.pu { background: rgba(167,139,250,.12); }
.card-icon.rd { background: rgba(239,68,68,.12); }
.card-sub { font: 400 10px var(--sans); color: var(--text-2); margin-top: 1px; }
.card-badge {
  font: 500 9px var(--mono);
  padding: 2px 8px;
  border-radius: 50px;
  text-transform: uppercase;
  letter-spacing: .04em;
}
.card-badge.req { background: rgba(239,68,68,.1); color: var(--red); border: 1px solid rgba(239,68,68,.2); }
.card-badge.opt { background: rgba(59,130,246,.1); color: var(--blue); border: 1px solid rgba(59,130,246,.2); }
.card-body { padding: 16px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FORM ELEMENTS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fg { display: flex; flex-direction: column; gap: 5px; }
.fl {
  font: 500 9px var(--mono);
  text-transform: uppercase;
  letter-spacing: .06em;
  color: var(--text-2);
}
.fi, .fs {
  padding: 7px 10px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  color: var(--text-0);
  font: 400 12px var(--mono);
  outline: none;
  transition: border .15s;
}
.fi:focus, .fs:focus {
  border-color: var(--border-focus);
  box-shadow: 0 0 0 2px rgba(59,130,246,.1);
}
.fi::placeholder { color: var(--text-2); }
.fi.err { border-color: var(--red); }
.fs {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='10' viewBox='0 0 24 24' fill='none' stroke='%235a6a80' stroke-width='2'%3E%3Cpath d='M6 9l6 6 6-6'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 8px center;
  padding-right: 24px;
}
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
.grid4 { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px; }
.fhint { font: 400 9px var(--sans); color: var(--text-2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PORT SELECTOR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.port-wrap { position: relative; }
.port-input {
  width: 100%;
  padding: 9px 12px 9px 36px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  color: var(--text-0);
  font: 400 12px var(--sans);
  outline: none;
  transition: border .15s;
}
.port-input:focus { border-color: var(--border-focus); box-shadow: 0 0 0 2px rgba(59,130,246,.1); }
.port-ico {
  position: absolute;
  left: 11px;
  top: 50%;
  transform: translateY(-50%);
  font-size: 14px;
  pointer-events: none;
}
.port-dd {
  position: absolute;
  top: calc(100% + 3px);
  left: 0; right: 0;
  background: var(--bg-4);
  border: 1px solid var(--border-1);
  border-radius: var(--r-md);
  box-shadow: 0 12px 32px rgba(0,0,0,.5);
  z-index: 200;
  max-height: 240px;
  overflow-y: auto;
  display: none;
}
.port-dd.open { display: block; }
.port-opt {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  cursor: pointer;
  border-bottom: 1px solid var(--border-0);
  transition: background .1s;
}
.port-opt:last-child { border-bottom: none; }
.port-opt:hover { background: var(--bg-hover); }
.port-opt-flag { font-size: 15px; width: 20px; text-align: center; }
.port-opt-name { font: 500 12px var(--sans); }
.port-opt-meta { font: 400 9px var(--mono); color: var(--text-2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.map-box {
  position: relative;
  height: 240px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-lg);
  overflow: hidden;
}
.map-box canvas { width: 100%; height: 100%; display: block; }
.map-chips {
  position: absolute;
  bottom: 10px; left: 10px;
  display: flex; gap: 6px;
}
.map-chip {
  font: 500 10px var(--mono);
  padding: 4px 10px;
  background: rgba(6,9,15,.85);
  backdrop-filter: blur(6px);
  border: 1px solid var(--border-0);
  border-radius: var(--r-sm);
  color: var(--text-1);
}
.map-chip b { color: var(--cyan); font-weight: 600; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RATE RANGE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.rate-bar {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 12px 16px;
  background: linear-gradient(135deg, rgba(59,130,246,.04), rgba(34,211,238,.04));
  border: 1px solid var(--border-0);
  border-radius: var(--r-lg);
  margin-top: 12px;
}
.rate-prices { display: flex; align-items: baseline; gap: 6px; font-family: var(--mono); }
.rate-val { font: 700 20px var(--mono); color: var(--cyan); }
.rate-sep { color: var(--text-2); font-size: 13px; }
.rate-label { font: 500 9px var(--mono); color: var(--text-2); text-transform: uppercase; letter-spacing: .05em; }
.rate-trend {
  font: 500 11px var(--mono);
  padding: 2px 7px;
  border-radius: var(--r-sm);
}
.rate-trend.up { color: var(--red); background: rgba(239,68,68,.1); }
.rate-trend.down { color: var(--green); background: rgba(16,185,129,.1); }
.rate-trend.flat { color: var(--amber); background: rgba(245,158,11,.1); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEIGHT VALIDATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.wv {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 10px 12px;
  border-radius: var(--r-md);
  font-size: 11px;
  margin-top: 12px;
}
.wv.ok  { background: rgba(16,185,129,.08); border: 1px solid rgba(16,185,129,.2); color: #34d399; }
.wv.wrn { background: rgba(245,158,11,.08); border: 1px solid rgba(245,158,11,.2); color: var(--amber); }
.wv.bad { background: rgba(239,68,68,.08); border: 1px solid rgba(239,68,68,.2); color: var(--red); }
.wv-bar { height: 4px; background: var(--bg-0); border-radius: 2px; margin-top: 6px; overflow: hidden; }
.wv-fill { height: 100%; border-radius: 2px; transition: width .3s; }
.wv-fill.ok  { background: var(--green); }
.wv-fill.wrn { background: var(--amber); }
.wv-fill.bad { background: var(--red); }
.wv-nums { font: 400 9px var(--mono); color: var(--text-2); margin-top: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SERVICE ADD-ONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.svc-cat { margin-bottom: 14px; }
.svc-cat:last-child { margin-bottom: 0; }
.svc-cat-head {
  display: flex;
  align-items: center;
  gap: 6px;
  padding-bottom: 6px;
  margin-bottom: 8px;
  border-bottom: 1px solid var(--border-0);
  font: 600 10px var(--sans);
  text-transform: uppercase;
  letter-spacing: .04em;
  color: var(--text-1);
}
.svc-cat-cnt {
  font: 400 9px var(--mono);
  padding: 1px 5px;
  background: var(--bg-0);
  border-radius: var(--r-sm);
  color: var(--text-2);
}
.svc {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  padding: 9px 12px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  margin-bottom: 5px;
  cursor: pointer;
  transition: all .12s;
}
.svc:hover { border-color: var(--border-1); background: var(--bg-hover); }
.svc.on { border-color: var(--blue); background: rgba(59,130,246,.06); }
.svc.locked { opacity: .7; cursor: default; }
.svc.locked.on { opacity: 1; }
.svc-chk {
  width: 16px; height: 16px;
  border: 2px solid var(--border-1);
  border-radius: 3px;
  display: grid; place-items: center;
  flex-shrink: 0;
  margin-top: 1px;
  transition: all .12s;
  font: 700 9px var(--sans);
  color: transparent;
}
.svc.on .svc-chk { background: var(--blue); border-color: var(--blue); color: #fff; }
.svc-info { flex: 1; min-width: 0; }
.svc-name { font: 500 12px var(--sans); display: flex; align-items: center; gap: 5px; }
.svc-req-dot { width: 4px; height: 4px; background: var(--red); border-radius: 50%; }
.svc-desc { font: 400 10px var(--sans); color: var(--text-2); margin-top: 1px; }
.svc-docs { display: flex; gap: 3px; flex-wrap: wrap; margin-top: 5px; }
.svc-doc-tag {
  font: 500 8px var(--mono);
  padding: 1px 5px;
  background: rgba(167,139,250,.08);
  border: 1px solid rgba(167,139,250,.15);
  border-radius: 2px;
  color: var(--purple);
  text-transform: uppercase;
  letter-spacing: .02em;
}
.svc-price { font: 600 12px var(--mono); color: var(--cyan); white-space: nowrap; }
.svc-basis { font: 400 9px var(--mono); color: var(--text-2); text-align: right; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FREE DAYS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.fd-grid { display: grid; grid-template-columns: repeat(4,1fr); gap: 6px; }
.fd-opt {
  padding: 10px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  cursor: pointer;
  text-align: center;
  transition: all .12s;
}
.fd-opt:hover { border-color: var(--border-1); }
.fd-opt.on { border-color: var(--blue); background: rgba(59,130,246,.06); }
.fd-num { font: 700 18px var(--mono); }
.fd-label { font: 400 9px var(--sans); color: var(--text-2); margin-top: 2px; }
.fd-cost { font: 400 9px var(--mono); color: var(--amber); margin-top: 3px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARRIER CARDS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cr {
  display: grid;
  grid-template-columns: 48px 1fr auto;
  gap: 12px;
  align-items: center;
  padding: 12px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  cursor: pointer;
  transition: all .12s;
  margin-bottom: 6px;
}
.cr:hover { border-color: var(--border-1); background: var(--bg-hover); }
.cr.on {
  border-color: var(--blue);
  background: rgba(59,130,246,.05);
  box-shadow: 0 0 16px rgba(59,130,246,.08);
}
.cr-logo {
  width: 48px; height: 48px;
  background: var(--bg-3);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  display: grid; place-items: center;
  font: 700 10px var(--mono);
  color: var(--text-1);
}
.cr-name { font: 600 13px var(--sans); display: flex; align-items: center; gap: 6px; }
.cr-badge {
  font: 500 8px var(--mono);
  padding: 2px 6px;
  border-radius: 50px;
  text-transform: uppercase;
  letter-spacing: .03em;
  background: rgba(16,185,129,.1);
  color: var(--green);
  border: 1px solid rgba(16,185,129,.2);
}
.cr-meta {
  display: flex; gap: 12px;
  margin-top: 4px;
  font: 400 10px var(--mono);
  color: var(--text-2);
}
.cr-rate { font: 700 18px var(--mono); text-align: right; }
.cr-per { font: 400 9px var(--mono); color: var(--text-2); text-align: right; }
.cr-avail {
  font: 500 9px var(--mono);
  margin-top: 3px;
  padding: 1px 5px;
  border-radius: var(--r-sm);
  display: inline-block;
}
.cr-avail.yes { background: rgba(16,185,129,.1); color: var(--green); }
.cr-avail.maybe { background: rgba(245,158,11,.1); color: var(--amber); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INSURANCE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ins-toggle {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 16px;
  background: linear-gradient(135deg, rgba(16,185,129,.04), rgba(34,211,238,.04));
  border: 1px solid var(--border-0);
  border-radius: var(--r-lg);
  cursor: pointer;
  transition: all .15s;
}
.ins-toggle.on { border-color: var(--green); box-shadow: 0 0 14px rgba(16,185,129,.08); }
.ins-toggle-info { display: flex; align-items: center; gap: 10px; }
.ins-label { font: 600 13px var(--sans); }
.ins-sub { font: 400 10px var(--sans); color: var(--text-2); margin-top: 1px; }
.tog {
  width: 38px; height: 20px;
  background: var(--bg-0);
  border: 2px solid var(--border-1);
  border-radius: 10px;
  position: relative;
  transition: all .2s;
}
.tog.on { background: var(--green); border-color: var(--green); }
.tog-knob {
  width: 14px; height: 14px;
  background: #fff;
  border-radius: 50%;
  position: absolute;
  top: 1px; left: 1px;
  transition: transform .2s;
}
.tog.on .tog-knob { transform: translateX(18px); }

.cov-grid { display: grid; grid-template-columns: repeat(3,1fr); gap: 6px; margin-top: 14px; }
.cov-opt {
  padding: 10px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  cursor: pointer;
  text-align: center;
  transition: all .12s;
}
.cov-opt:hover { border-color: var(--border-1); }
.cov-opt.on { border-color: var(--green); background: rgba(16,185,129,.06); }
.cov-name { font: 600 12px var(--sans); }
.cov-rate { font: 400 10px var(--mono); color: var(--text-2); margin-top: 2px; }
.cov-prem { font: 700 14px var(--mono); color: var(--green); margin-top: 6px; }

.ins-detail { margin-top: 14px; }
.ins-stat { display: grid; grid-template-columns: repeat(3,1fr); gap: 10px; }
.ins-stat-label { font: 400 9px var(--mono); color: var(--text-2); text-transform: uppercase; letter-spacing: .04em; }
.ins-stat-val { font: 600 13px var(--mono); color: var(--cyan); margin-top: 2px; }
.ins-tags { display: flex; flex-wrap: wrap; gap: 3px; margin-top: 10px; }
.ins-tag {
  font: 500 8px var(--mono);
  padding: 2px 6px;
  border-radius: 2px;
}
.ins-tag.inc { background: rgba(16,185,129,.08); border: 1px solid rgba(16,185,129,.15); color: var(--green); }
.ins-tag.exc { background: rgba(239,68,68,.08); border: 1px solid rgba(239,68,68,.15); color: var(--red); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOCUMENTS & BL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.bl-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
.bl-opt {
  padding: 10px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
  cursor: pointer;
  text-align: center;
  transition: all .12s;
}
.bl-opt:hover { border-color: var(--border-1); }
.bl-opt.on { border-color: var(--blue); background: rgba(59,130,246,.06); }
.bl-name { font: 500 12px var(--sans); }
.bl-desc { font: 400 9px var(--sans); color: var(--text-2); margin-top: 2px; }

.doc-list { display: grid; gap: 4px; margin-top: 14px; }
.doc-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 8px 12px;
  background: var(--bg-0);
  border: 1px solid var(--border-0);
  border-radius: var(--r-md);
}
.doc-dot { width: 7px; height: 7px; border-radius: 50%; flex-shrink: 0; }
.doc-dot.pending { background: var(--text-2); }
.doc-dot.review  { background: var(--blue); }
.doc-dot.done    { background: var(--green); }
.doc-name { flex: 1; font: 500 11px var(--sans); }
.doc-req {
  font: 500 8px var(--mono);
  padding: 1px 5px;
  background: rgba(239,68,68,.08);
  border: 1px solid rgba(239,68,68,.15);
  border-radius: 2px;
  color: var(--red);
}
.doc-status { font: 400 9px var(--mono); color: var(--text-2); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR â€“ PRICE BREAKDOWN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sb-section {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border-0);
}
.sb-title {
  font: 600 9px var(--mono);
  text-transform: uppercase;
  letter-spacing: .06em;
  color: var(--text-2);
  margin-bottom: 8px;
}
.sb-line {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 2px 0;
  font-size: 11px;
}
.sb-line.sub {
  padding-top: 6px;
  margin-top: 6px;
  border-top: 1px solid var(--border-0);
  font-weight: 600;
}
.sb-label { color: var(--text-1); }
.sb-amt { font-family: var(--mono); font-weight: 500; }
.sb-amt.neg { color: var(--green); }

.sb-total {
  display: flex;
  justify-content: space-between;
  align-items: baseline;
  padding: 14px 16px;
  background: linear-gradient(135deg, var(--bg-3), var(--bg-4));
  border-top: 2px solid var(--blue);
}
.sb-total-label { font: 600 11px var(--sans); text-transform: uppercase; letter-spacing: .04em; }
.sb-total-val { font: 700 22px var(--mono); color: var(--cyan); }
.sb-net { font: 400 10px var(--mono); color: var(--green); text-align: right; margin-top: 2px; }

.sb-incent {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 6px 10px;
  background: rgba(16,185,129,.06);
  border: 1px solid rgba(16,185,129,.15);
  border-radius: var(--r-md);
  margin-bottom: 5px;
}
.sb-incent-type { font: 500 11px var(--sans); color: #34d399; }
.sb-incent-amt { font: 600 11px var(--mono); color: var(--green); }
.sb-incent-note { font: 400 8px var(--mono); color: var(--text-2); margin-top: 1px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BUTTONS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 9px 18px;
  border-radius: var(--r-md);
  font: 600 12px var(--sans);
  cursor: pointer;
  border: none;
  outline: none;
  transition: all .15s;
}
.btn-pri {
  background: linear-gradient(135deg, var(--blue), #2563eb);
  color: #fff;
  box-shadow: 0 2px 8px rgba(59,130,246,.25);
}
.btn-pri:hover { box-shadow: 0 4px 14px rgba(59,130,246,.35); transform: translateY(-1px); }
.btn-pri:disabled { opacity: .4; cursor: default; transform: none; box-shadow: none; }
.btn-suc {
  background: linear-gradient(135deg, var(--green), #059669);
  color: #fff;
  box-shadow: 0 2px 8px rgba(16,185,129,.25);
}
.btn-suc:hover { box-shadow: 0 4px 14px rgba(16,185,129,.35); transform: translateY(-1px); }
.btn-full { width: 100%; }
.btn-lg { padding: 12px 20px; font-size: 13px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITIES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mt-2 { margin-top: 8px; }
.mt-3 { margin-top: 12px; }
.mt-4 { margin-top: 16px; }
.mb-2 { margin-bottom: 8px; }
.hidden { display: none !important; }
.row { display: flex; gap: 8px; }
.row-center { display: flex; align-items: center; gap: 8px; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}
.anim { animation: fadeUp .25s ease forwards; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RESPONSIVE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 960px) {
  #app { grid-template-columns: 1fr; }
  .sidebar {
    position: fixed; bottom: 0; left: 0; right: 0;
    max-height: 42vh;
    border-left: none;
    border-top: 2px solid var(--blue);
    z-index: 50;
  }
}
</style>
</head>

<body>
<div id="app">

  <!-- â•â•â• TOP BAR â•â•â• -->
  <header class="topbar">
    <div class="topbar-brand">
      <div class="topbar-logo">W</div>
      <span class="topbar-name">Wort Freight</span>
      <span class="topbar-tag">Terminal v2.0</span>
    </div>
    <div class="topbar-status">
      <span class="topbar-dot"></span>
      Market Data: Live &middot; <span id="clock"></span>
    </div>
  </header>

  <!-- â•â•â• MAIN PANEL â•â•â• -->
  <main class="main" id="main">

    <!-- â”€â”€ 1. ROUTE SEARCH â”€â”€ -->
    <div class="card" id="card-search">
      <div class="card-head">
        <div class="card-title">
          <div class="card-icon bl">ğŸ”</div>
          <div>
            <div>Route Search</div>
            <div class="card-sub">Find optimal shipping routes</div>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="grid3" style="grid-template-columns:1fr 1fr auto;align-items:end">
          <!-- Origin -->
          <div class="fg">
            <label class="fl">Origin Port</label>
            <div class="port-wrap" id="origin-wrap">
              <span class="port-ico">ğŸš¢</span>
              <input class="port-input" id="origin-input" placeholder="Search port or city..." autocomplete="off">
              <div class="port-dd" id="origin-dd"></div>
            </div>
          </div>
          <!-- Destination -->
          <div class="fg">
            <label class="fl">Destination Port</label>
            <div class="port-wrap" id="dest-wrap">
              <span class="port-ico">ğŸ“</span>
              <input class="port-input" id="dest-input" placeholder="Search port or city..." autocomplete="off">
              <div class="port-dd" id="dest-dd"></div>
            </div>
          </div>
          <button class="btn btn-pri btn-lg" id="btn-search" disabled>Search Rates â†’</button>
        </div>
        <!-- Rate Range -->
        <div class="rate-bar hidden" id="rate-bar">
          <div style="flex:1">
            <div class="rate-label">Estimated Freight Price Range</div>
            <div class="rate-prices">
              <span class="rate-val" id="rate-min"></span>
              <span class="rate-sep">â€“</span>
              <span class="rate-val" id="rate-max"></span>
            </div>
          </div>
          <div style="text-align:right">
            <div id="rate-trend"></div>
            <div class="fhint mt-2" id="rate-pts"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ MAP â”€â”€ -->
    <div class="map-box hidden" id="map-box">
      <canvas id="map-canvas"></canvas>
      <div class="map-chips">
        <div class="map-chip">ğŸ“ <b id="map-dist"></b> NM</div>
        <div class="map-chip">â±ï¸ <b id="map-days"></b> days transit</div>
      </div>
    </div>

    <!-- â”€â”€ 2. CARGO â”€â”€ -->
    <div class="card hidden" id="card-cargo">
      <div class="card-head">
        <div class="card-title">
          <div class="card-icon am">ğŸ“¦</div>
          <div>
            <div>Cargo Requirements</div>
            <div class="card-sub">Container specs &amp; cargo details</div>
          </div>
        </div>
        <span class="card-badge req">Required</span>
      </div>
      <div class="card-body">
        <div class="grid4">
          <div class="fg">
            <label class="fl">Container Size</label>
            <select class="fs" id="c-size">
              <option value="20ft">20ft Standard</option>
              <option value="40ft">40ft Standard</option>
              <option value="40ft-HC">40ft High Cube</option>
              <option value="45ft-HC">45ft High Cube</option>
            </select>
          </div>
          <div class="fg">
            <label class="fl">Container Type</label>
            <select class="fs" id="c-type">
              <option value="Standard">Standard</option>
              <option value="Reefer">Reefer</option>
              <option value="Open-Top">Open-Top</option>
              <option value="Flat-Rack">Flat-Rack</option>
              <option value="Tank">Tank</option>
            </select>
          </div>
          <div class="fg">
            <label class="fl">Quantity</label>
            <input class="fi" type="number" id="c-qty" value="1" min="1" max="999">
          </div>
          <div class="fg">
            <label class="fl">Gross Weight / Container</label>
            <div class="row">
              <input class="fi" type="number" id="c-wt" placeholder="0.0" min="0" step="0.1" style="flex:1">
              <select class="fs" id="c-wt-unit" style="width:62px">
                <option value="MT">MT</option>
                <option value="KG">KG</option>
                <option value="LBS">LBS</option>
              </select>
            </div>
          </div>
        </div>
        <!-- Weight Validation -->
        <div class="hidden" id="wv-box"></div>
        <!-- Cargo Details -->
        <div class="grid3 mt-3">
          <div class="fg">
            <label class="fl">Commodity</label>
            <input class="fi" id="c-comm" placeholder="e.g., Cotton Textiles">
          </div>
          <div class="fg">
            <label class="fl">HS Code</label>
            <input class="fi" id="c-hs" placeholder="e.g., 6109.10.00">
            <span class="fhint">Used for incentive calc</span>
          </div>
          <div class="fg">
            <label class="fl">Cargo Value (USD)</label>
            <input class="fi" id="c-val" type="number" placeholder="0.00" min="0" step="100">
          </div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ 3. ORIGIN SERVICES â”€â”€ -->
    <div class="card hidden" id="card-origin-svc">
      <div class="card-head">
        <div class="card-title">
          <div class="card-icon bl">ğŸš¢</div>
          <div>
            <div>Origin Services</div>
            <div class="card-sub">Export-side logistics &amp; documentation</div>
          </div>
        </div>
        <span class="card-badge opt">Add-ons</span>
      </div>
      <div class="card-body" id="origin-svc-body"></div>
    </div>

    <!-- â”€â”€ 3b. DESTINATION SERVICES â”€â”€ -->
    <div class="card hidden" id="card-dest-svc">
      <div class="card-head">
        <div class="card-title">
          <div class="card-icon gr">ğŸ“</div>
          <div>
            <div>Destination Services</div>
            <div class="card-sub">Import-side logistics &amp; last-mile</div>
          </div>
        </div>
        <span class="card-badge opt">Add-ons</span>
      </div>
      <div class="card-body" id="dest-svc-body">
        <!-- destination services render here -->
        <div id="dest-svc-list"></div>
        <!-- Free Days -->
        <div class="svc-cat" id="fd-section">
          <div class="svc-cat-head">
            <span>â°</span> Destination Free Days Extension
          </div>
          <div class="fhint mb-2">Extend free days to prevent detention &amp; demurrage charges</div>
          <div class="fd-grid" id="fd-grid"></div>
          <div class="hidden mt-2" id="fd-custom-wrap">
            <div class="fg" style="max-width:160px">
              <label class="fl">Custom Days</label>
              <input class="fi" type="number" id="fd-custom" min="1" max="60" value="10">
            </div>
          </div>
          <div class="hidden mt-2" id="fd-cost" style="font:500 11px var(--mono);color:var(--amber)"></div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ 4. CARRIER SELECTION â”€â”€ -->
    <div class="card hidden" id="card-carrier">
      <div class="card-head">
        <div class="card-title">
          <div class="card-icon pu">âš“</div>
          <div>
            <div>Carrier Selection</div>
            <div class="card-sub" id="cr-count"></div>
          </div>
        </div>
      </div>
      <div class="card-body" id="carrier-body"></div>
    </div>

    <!-- â”€â”€ 5. INSURANCE â”€â”€ -->
    <div class="card hidden" id="card-insurance">
      <div class="card-head">
        <div class="card-title">
          <div class="card-icon gr">ğŸ›¡ï¸</div>
          <div>
            <div>Cargo Insurance</div>
            <div class="card-sub">Protect your shipment</div>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="ins-toggle" id="ins-toggle">
          <div class="ins-toggle-info">
            <span style="font-size:20px">ğŸ›¡ï¸</span>
            <div>
              <div class="ins-label">Comprehensive Cargo Coverage</div>
              <div class="ins-sub">One-click insurance, auto-calculated premiums</div>
            </div>
          </div>
          <div class="tog" id="ins-tog"><div class="tog-knob"></div></div>
        </div>
        <div class="hidden" id="ins-body">
          <div class="cov-grid" id="cov-grid"></div>
          <div class="ins-detail hidden" id="ins-detail"></div>
        </div>
      </div>
    </div>

    <!-- â”€â”€ 6. DOCUMENTS â”€â”€ -->
    <div class="card hidden" id="card-docs">
      <div class="card-head">
        <div class="card-title">
          <div class="card-icon pu">ğŸ“„</div>
          <div>
            <div>Documents &amp; B/L Type</div>
            <div class="card-sub">Required docs based on selected services</div>
          </div>
        </div>
      </div>
      <div class="card-body">
        <div class="fl mb-2">Bill of Lading Type</div>
        <div class="bl-grid" id="bl-grid"></div>
        <div class="doc-list mt-3" id="doc-list"></div>
      </div>
    </div>

  </main>

  <!-- â•â•â• SIDEBAR â•â•â• -->
  <aside class="sidebar" id="sidebar">
    <div class="sb-section" style="background:var(--bg-3)">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <span style="font:600 12px var(--sans)">ğŸ’° Price Breakdown</span>
        <span id="sb-spec" style="font:400 9px var(--mono);color:var(--text-2)"></span>
      </div>
    </div>
    <div id="sb-content" style="flex:1;overflow-y:auto">
      <div class="sb-section" style="text-align:center;padding:40px 16px">
        <div style="font-size:28px;margin-bottom:8px">ğŸ’°</div>
        <div style="font:400 11px var(--sans);color:var(--text-2)">Configure your shipment to see<br>the total landing cost</div>
      </div>
    </div>
    <div id="sb-total" class="hidden">
      <div class="sb-total">
        <div>
          <div class="sb-total-label">Total Landing Cost</div>
          <div class="sb-net hidden" id="sb-net"></div>
        </div>
        <div class="sb-total-val" id="sb-total-val">$0</div>
      </div>
      <div class="sb-section">
        <button class="btn btn-suc btn-full btn-lg" id="btn-book">ğŸ“‹ Confirm Booking</button>
        <div style="font:400 9px var(--mono);color:var(--text-2);text-align:center;margin-top:8px">Rates valid 7 days Â· No hidden charges</div>
      </div>
    </div>
  </aside>

</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const FLAGS = {IN:'ğŸ‡®ğŸ‡³',US:'ğŸ‡ºğŸ‡¸',GB:'ğŸ‡¬ğŸ‡§',SG:'ğŸ‡¸ğŸ‡¬',AE:'ğŸ‡¦ğŸ‡ª',CN:'ğŸ‡¨ğŸ‡³',NL:'ğŸ‡³ğŸ‡±',DE:'ğŸ‡©ğŸ‡ª',JP:'ğŸ‡¯ğŸ‡µ'};

const PORTS = [
  {code:'INNSA',name:'Jawaharlal Nehru Port',city:'Nhava Sheva',country:'India',cc:'IN',lat:18.95,lng:72.95},
  {code:'INMUN',name:'Mumbai Port',city:'Mumbai',country:'India',cc:'IN',lat:18.93,lng:72.84},
  {code:'USNYC',name:'Port of New York',city:'New York',country:'United States',cc:'US',lat:40.68,lng:-74.04},
  {code:'GBFXT',name:'Port of Felixstowe',city:'Felixstowe',country:'UK',cc:'GB',lat:51.95,lng:1.35},
  {code:'SGSIN',name:'Port of Singapore',city:'Singapore',country:'Singapore',cc:'SG',lat:1.26,lng:103.82},
  {code:'AEJEA',name:'Jebel Ali Port',city:'Dubai',country:'UAE',cc:'AE',lat:25.01,lng:55.06},
  {code:'CNSHA',name:'Port of Shanghai',city:'Shanghai',country:'China',cc:'CN',lat:31.36,lng:121.59},
  {code:'NLRTM',name:'Port of Rotterdam',city:'Rotterdam',country:'Netherlands',cc:'NL',lat:51.90,lng:4.50},
  {code:'DEHAM',name:'Port of Hamburg',city:'Hamburg',country:'Germany',cc:'DE',lat:53.53,lng:9.96},
  {code:'JPTYO',name:'Port of Tokyo',city:'Tokyo',country:'Japan',cc:'JP',lat:35.63,lng:139.77},
];

const CONTAINER_SPECS = {
  '20ft-Standard':{max:28200,tare:2300},'40ft-Standard':{max:28750,tare:3750},
  '40ft-HC-Standard':{max:28560,tare:3940},'45ft-HC-Standard':{max:27600,tare:4800},
  '20ft-Reefer':{max:27400,tare:3100},'40ft-Reefer':{max:27700,tare:4800},
  '40ft-HC-Reefer':{max:26280,tare:4220},'20ft-Open-Top':{max:28130,tare:2370},
  '40ft-Open-Top':{max:26630,tare:3870},'40ft-Flat-Rack':{max:39200,tare:5300},
  '20ft-Flat-Rack':{max:27400,tare:2560},'20ft-Tank':{max:26000,tare:3600},
  '40ft-Tank':{max:26000,tare:5500},
};

const CARRIERS = [
  {id:'maersk',name:'Maersk',code:'MAEU',assured:true,rel:94,days:22,freeDest:4},
  {id:'msc',name:'MSC',code:'MSCU',assured:true,rel:91,days:24,freeDest:4},
  {id:'cmacgm',name:'CMA CGM',code:'CMDU',assured:true,rel:92,days:23,freeDest:4},
  {id:'hapag',name:'Hapag-Lloyd',code:'HLCU',assured:true,rel:93,days:22,freeDest:5},
  {id:'cosco',name:'COSCO',code:'COSU',assured:true,rel:89,days:25,freeDest:7},
  {id:'evergreen',name:'Evergreen',code:'EGLV',assured:false,rel:90,days:24,freeDest:4},
  {id:'one',name:'ONE',code:'ONEY',assured:true,rel:91,days:23,freeDest:4},
  {id:'hmm',name:'HMM',code:'HDMU',assured:false,rel:88,days:26,freeDest:5},
  {id:'yangming',name:'Yang Ming',code:'YMLU',assured:false,rel:87,days:25,freeDest:4},
  {id:'zim',name:'ZIM',code:'ZIMU',assured:true,rel:90,days:21,freeDest:4},
  {id:'ial',name:'IAL',code:'IALU',assured:true,rel:86,days:28,freeDest:4},
  {id:'wanhai',name:'Wan Hai',code:'WHLC',assured:false,rel:88,days:26,freeDest:4},
];

const BASE_PRICES = {'INNSA-USNYC':1350,'INNSA-GBFXT':1180,'INNSA-NLRTM':1220,'INNSA-DEHAM':1250,'INNSA-SGSIN':450,'INNSA-AEJEA':380,'INNSA-CNSHA':680,'INNSA-JPTYO':750,'CNSHA-USNYC':2100,'CNSHA-GBFXT':1850};
const SIZE_MULT = {'20ft':1,'40ft':1.75,'40ft-HC':1.85,'45ft-HC':2.1};
const TYPE_MULT = {'Standard':1,'Reefer':2.2,'Open-Top':1.4,'Flat-Rack':1.6,'Tank':1.8};

const SERVICES = [
  {id:'o-thc',cat:'origin-local',name:'Terminal Handling',desc:'Lift-on/lift-off at origin',price:185,basis:'cntr',req:true,on:true,docs:[]},
  {id:'o-bl',cat:'origin-local',name:'B/L Fee',desc:'Documentation for B/L issuance',price:50,basis:'bl',req:true,on:true,docs:['bill-of-lading']},
  {id:'o-seal',cat:'origin-local',name:'Seal Charges',desc:'One-time seal per container',price:15,basis:'cntr',req:true,on:true,docs:[]},
  {id:'o-ens',cat:'origin-local',name:'ENS Filing',desc:'Entry Summary Declaration (EU)',price:30,basis:'bl',req:false,on:false,docs:[]},
  {id:'o-cc',cat:'origin-customs',name:'Customs Clearance',desc:'Full export customs clearance',price:120,basis:'ship',req:false,on:false,docs:['shipping-bill','packing-list','commercial-invoice']},
  {id:'o-exam',cat:'origin-customs',name:'Customs Examination',desc:'Physical / X-ray coordination',price:75,basis:'cntr',req:false,on:false,docs:['shipping-bill']},
  {id:'o-coo',cat:'origin-customs',name:'Certificate of Origin',desc:'CoO procurement & attestation',price:45,basis:'ship',req:false,on:false,docs:['certificate-of-origin']},
  {id:'o-stuff',cat:'origin-cfs',name:'CFS Stuffing',desc:'Consolidation & stuffing at CFS',price:95,basis:'cntr',req:false,on:false,docs:['packing-list']},
  {id:'o-store',cat:'origin-cfs',name:'CFS Storage',desc:'Storage at CFS (3 days free)',price:25,basis:'cntr',req:false,on:false,docs:[]},
  {id:'o-fum',cat:'origin-cfs',name:'Fumigation',desc:'Pest treatment & certification',price:65,basis:'cntr',req:false,on:false,docs:['fumigation']},
  {id:'d-thc',cat:'dest-local',name:'Terminal Handling',desc:'Handling at destination terminal',price:210,basis:'cntr',req:true,on:true,docs:[]},
  {id:'d-do',cat:'dest-local',name:'Delivery Order Fee',desc:'DO issuance & processing',price:45,basis:'bl',req:true,on:true,docs:[]},
  {id:'d-isps',cat:'dest-local',name:'ISPS Charge',desc:'Port facility security',price:15,basis:'cntr',req:true,on:true,docs:[]},
  {id:'d-cc',cat:'dest-customs',name:'Import Customs Clearance',desc:'Full import clearance & duty',price:150,basis:'ship',req:false,on:false,docs:['commercial-invoice','packing-list','bill-of-lading']},
  {id:'d-duty',cat:'dest-customs',name:'Duty Payment',desc:'Customs duty & tax processing',price:35,basis:'ship',req:false,on:false,docs:[]},
  {id:'d-local',cat:'dest-transport',name:'Local Transportation',desc:'Haulage within 50km',price:285,basis:'cntr',req:false,on:false,docs:[]},
  {id:'d-long',cat:'dest-transport',name:'Long Haul Transport',desc:'Inland transport beyond 50km',price:450,basis:'cntr',req:false,on:false,docs:[]},
  {id:'d-destuff',cat:'dest-transport',name:'Destuffing & Delivery',desc:'Container destuffing & final delivery',price:120,basis:'cntr',req:false,on:false,docs:[]},
];

const FREE_DAYS = [
  {days:4,label:'4 Days',sub:'Standard',costDay:0},
  {days:7,label:'7 Days',sub:'+$35/day',costDay:35},
  {days:14,label:'14 Days',sub:'+$50/day',costDay:50},
  {days:0,label:'Custom',sub:'+$65/day',costDay:65,custom:true},
];

const BL_TYPES = [
  {type:'House-BL',label:'House B/L',desc:'Issued by NVOCC / forwarder'},
  {type:'Master-BL',label:'Master B/L',desc:'Issued directly by carrier'},
  {type:'Seaway-Bill',label:'Seaway Bill',desc:'Non-negotiable, faster release'},
  {type:'Express-BL',label:'Express B/L',desc:'Telex release, no original needed'},
];

const RODTEP = {'61':4.3,'62':4.3,'63':3.8,'84':1.6,'85':1.8,'29':2.5,'30':3,'72':1.5,'73':2};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const S = {
  origin: null,
  dest: null,
  route: null,
  rateRange: null,
  containerSize: '20ft',
  containerType: 'Standard',
  qty: 1,
  weight: 0,
  weightUnit: 'MT',
  commodity: '',
  hsCode: '',
  cargoValue: 0,
  services: SERVICES.map(s => ({...s})),
  freeDays: 4,
  freeDaysCustom: false,
  customDays: 10,
  carrierQuotes: [],
  selectedCarrier: null,
  insEnabled: false,
  coverageType: 'Comprehensive',
  blType: 'House-BL',
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const $ = id => document.getElementById(id);
const show = el => { if (typeof el === 'string') el = $(el); el.classList.remove('hidden'); };
const hide = el => { if (typeof el === 'string') el = $(el); el.classList.add('hidden'); };
const fmt = n => '$' + Number(n).toLocaleString('en-US',{minimumFractionDigits:0,maximumFractionDigits:0});

function toKG(w, unit) {
  if (unit === 'MT') return w * 1000;
  if (unit === 'LBS') return w * 0.453592;
  return w;
}

function haversine(a, b) {
  const R = 3440.065;
  const dLat = (b.lat - a.lat) * Math.PI / 180;
  const dLng = (b.lng - a.lng) * Math.PI / 180;
  const x = Math.sin(dLat/2)**2 + Math.cos(a.lat*Math.PI/180)*Math.cos(b.lat*Math.PI/180)*Math.sin(dLng/2)**2;
  return Math.round(R * 2 * Math.atan2(Math.sqrt(x), Math.sqrt(1-x)) * 1.15);
}

function addDays(d, n) { const r = new Date(d); r.setDate(r.getDate()+n); return r; }
function fmtDate(d) { return d.toLocaleDateString('en-US',{month:'short',day:'numeric'}); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PORT SELECTOR
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function initPortSelector(inputId, ddId, key) {
  const input = $(inputId);
  const dd = $(ddId);
  let open = false;

  function render(query) {
    const exclude = key === 'origin' ? S.dest : S.origin;
    const q = (query || '').toLowerCase();
    const list = PORTS.filter(p => {
      if (exclude && p.code === exclude.code) return false;
      if (!q) return true;
      return p.name.toLowerCase().includes(q) || p.city.toLowerCase().includes(q) || p.code.toLowerCase().includes(q);
    });
    dd.innerHTML = list.map(p => `
      <div class="port-opt" data-code="${p.code}">
        <span class="port-opt-flag">${FLAGS[p.cc]||'ğŸ´'}</span>
        <div>
          <div class="port-opt-name">${p.name}</div>
          <div class="port-opt-meta">${p.code} Â· ${p.city}, ${p.country}</div>
        </div>
      </div>
    `).join('') || '<div class="port-opt" style="justify-content:center;color:var(--text-2)">No ports found</div>';
  }

  input.addEventListener('focus', () => { open = true; dd.classList.add('open'); input.value = ''; render(''); });
  input.addEventListener('input', () => render(input.value));
  dd.addEventListener('click', e => {
    const opt = e.target.closest('.port-opt');
    if (!opt || !opt.dataset.code) return;
    const port = PORTS.find(p => p.code === opt.dataset.code);
    S[key] = port;
    input.value = `${port.name} (${port.code})`;
    dd.classList.remove('open');
    open = false;
    updateSearchButton();
  });
  document.addEventListener('click', e => {
    if (open && !input.contains(e.target) && !dd.contains(e.target)) {
      dd.classList.remove('open');
      open = false;
      if (S[key]) input.value = `${S[key].name} (${S[key].code})`;
    }
  });
}

function updateSearchButton() {
  $('btn-search').disabled = !(S.origin && S.dest);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SEARCH & MAP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function doSearch() {
  if (!S.origin || !S.dest) return;

  const dist = haversine(S.origin, S.dest);
  const days = Math.max(5, Math.floor(dist / 350));
  S.route = {dist, days};

  // Rate range
  const key = `${S.origin.code}-${S.dest.code}`;
  const base = BASE_PRICES[key] || 1200;
  const adj = base * (SIZE_MULT[S.containerSize]||1) * (TYPE_MULT[S.containerType]||1);
  const min = Math.round(adj * 0.88);
  const max = Math.round(adj * 1.12);
  const trends = ['rising','falling','stable'];
  const trend = trends[Math.floor(Math.random()*3)];
  const trendPct = (Math.random()*5).toFixed(1);
  const pts = Math.floor(Math.random()*200)+50;
  S.rateRange = {min, max, median: Math.round(adj), trend, trendPct, pts};

  // Show rate bar
  $('rate-min').textContent = fmt(min);
  $('rate-max').textContent = fmt(max);
  const arrow = trend==='rising'?'â†—':trend==='falling'?'â†˜':'â†’';
  const cls = trend==='rising'?'up':trend==='falling'?'down':'flat';
  $('rate-trend').className = `rate-trend ${cls}`;
  $('rate-trend').textContent = `${arrow} ${trendPct}%`;
  $('rate-pts').textContent = `${pts} data points`;
  show('rate-bar');

  // Draw map
  show('map-box');
  $('map-dist').textContent = dist.toLocaleString();
  $('map-days').textContent = days;
  drawMap();

  // Generate carrier quotes
  genCarrierQuotes();

  // Show all panels
  show('card-cargo');
  show('card-origin-svc');
  show('card-dest-svc');
  show('card-carrier');
  show('card-insurance');
  show('card-docs');

  renderServices();
  renderFreeDays();
  renderCarriers();
  renderBL();
  renderDocs();
  recalc();
}

function drawMap() {
  const canvas = $('map-canvas');
  const rect = canvas.parentElement.getBoundingClientRect();
  const dpr = window.devicePixelRatio || 1;
  canvas.width = rect.width * dpr;
  canvas.height = rect.height * dpr;
  canvas.style.width = rect.width + 'px';
  canvas.style.height = rect.height + 'px';
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  const W = rect.width, H = rect.height;

  // BG & grid
  ctx.fillStyle = '#06090f';
  ctx.fillRect(0, 0, W, H);
  ctx.strokeStyle = '#111a28';
  ctx.lineWidth = 0.5;
  for (let i = 0; i < W; i += 36) { ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,H); ctx.stroke(); }
  for (let i = 0; i < H; i += 36) { ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(W,i); ctx.stroke(); }

  const pts = [S.origin, S.dest];
  const lats = pts.map(p=>p.lat), lngs = pts.map(p=>p.lng);
  const pad = 12;
  const minLat = Math.min(...lats)-pad, maxLat = Math.max(...lats)+pad;
  const minLng = Math.min(...lngs)-pad, maxLng = Math.max(...lngs)+pad;
  const mx = lng => ((lng-minLng)/(maxLng-minLng))*(W-60)+30;
  const my = lat => H - (((lat-minLat)/(maxLat-minLat))*(H-60)+30);

  const x0=mx(S.origin.lng), y0=my(S.origin.lat);
  const x1=mx(S.dest.lng), y1=my(S.dest.lat);
  const cpx=(x0+x1)/2, cpy=Math.min(y0,y1)-30;

  // Glow
  ctx.beginPath(); ctx.strokeStyle='rgba(34,211,238,.12)'; ctx.lineWidth=10;
  ctx.moveTo(x0,y0); ctx.quadraticCurveTo(cpx,cpy,x1,y1); ctx.stroke();

  // Dashed path
  ctx.beginPath(); ctx.strokeStyle='#22d3ee'; ctx.lineWidth=2; ctx.setLineDash([8,4]);
  ctx.moveTo(x0,y0); ctx.quadraticCurveTo(cpx,cpy,x1,y1); ctx.stroke(); ctx.setLineDash([]);

  // Dots & labels
  [[x0,y0,S.origin,'#3b82f6'],[x1,y1,S.dest,'#10b981']].forEach(([x,y,p,c]) => {
    const g = ctx.createRadialGradient(x,y,0,x,y,18);
    g.addColorStop(0, c.replace(')',',0.3)').replace('rgb','rgba'));
    g.addColorStop(1, 'transparent');
    ctx.fillStyle = g;
    ctx.beginPath(); ctx.arc(x,y,18,0,Math.PI*2); ctx.fill();

    ctx.beginPath(); ctx.arc(x,y,5,0,Math.PI*2);
    ctx.fillStyle=c; ctx.fill();
    ctx.strokeStyle='#06090f'; ctx.lineWidth=2; ctx.stroke();

    ctx.font='11px Inter, sans-serif'; ctx.fillStyle='#94a3b8'; ctx.textAlign='center';
    ctx.fillText(p.name, x, y-12);
    ctx.font='9px JetBrains Mono, monospace'; ctx.fillStyle='#5a6a80';
    ctx.fillText(`${p.lat.toFixed(2)}Â°, ${p.lng.toFixed(2)}Â°`, x, y+16);
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WEIGHT VALIDATION
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function validateWeight() {
  const w = parseFloat($('c-wt').value) || 0;
  const unit = $('c-wt-unit').value;
  S.weight = w;
  S.weightUnit = unit;
  if (w <= 0) { hide('wv-box'); return; }

  const specKey = `${S.containerSize}-${S.containerType}`;
  const spec = CONTAINER_SPECS[specKey];
  if (!spec) {
    $('wv-box').className = 'wv bad';
    $('wv-box').innerHTML = `<span>âŒ</span><div>No spec found for ${S.containerSize} ${S.containerType}</div>`;
    show('wv-box');
    return;
  }

  const kg = toKG(w, unit);
  const pct = Math.min((kg/spec.max)*100, 100);
  let cls, ico;
  if (kg > spec.max) { cls='bad'; ico='âŒ'; }
  else if (pct > 90) { cls='wrn'; ico='âš ï¸'; }
  else if (pct < 20) { cls='wrn'; ico='âš ï¸'; }
  else { cls='ok'; ico='âœ…'; }

  let msg;
  if (kg > spec.max) msg = `Exceeds max payload by ${(kg-spec.max).toLocaleString()} KG. Max: ${spec.max.toLocaleString()} KG`;
  else if (pct > 90) msg = `${pct.toFixed(1)}% utilization â€” near limit, watch for port penalties`;
  else if (pct < 20) msg = `Low utilization (${pct.toFixed(1)}%) â€” consider LCL`;
  else msg = `Within limits. ${pct.toFixed(1)}% of ${spec.max.toLocaleString()} KG max`;

  $('wv-box').className = `wv ${cls} anim`;
  $('wv-box').innerHTML = `
    <span>${ico}</span>
    <div style="flex:1">
      <div>${msg}</div>
      <div class="wv-bar"><div class="wv-fill ${cls}" style="width:${pct}%"></div></div>
      <div class="wv-nums">${kg.toLocaleString()} KG / ${spec.max.toLocaleString()} KG (${pct.toFixed(1)}%)</div>
    </div>`;
  show('wv-box');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SERVICES
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ORIGIN_CATS = [
  {key:'origin-local',label:'Origin Local Charges',icon:'ğŸ­'},
  {key:'origin-customs',label:'Origin FCL Customs',icon:'ğŸ“‹'},
  {key:'origin-cfs',label:'Origin FCL CFS',icon:'ğŸ“¦'},
];
const DEST_CATS = [
  {key:'dest-local',label:'Destination Local',icon:'ğŸ—ï¸'},
  {key:'dest-customs',label:'Destination FCL Customs',icon:'ğŸ›ƒ'},
  {key:'dest-transport',label:'Destination Transportation',icon:'ğŸš›'},
];

function renderServiceCat(cat, container) {
  const items = S.services.filter(s => s.cat === cat.key);
  const selCnt = items.filter(s => s.on).length;
  let html = `<div class="svc-cat">
    <div class="svc-cat-head"><span>${cat.icon}</span> ${cat.label} <span class="svc-cat-cnt">${selCnt}/${items.length}</span></div>`;
  items.forEach(s => {
    const docTags = s.docs.map(d => `<span class="svc-doc-tag">${d.replace(/-/g,' ')}</span>`).join('');
    html += `
    <div class="svc ${s.on?'on':''} ${s.req?'locked':''}" data-sid="${s.id}">
      <div class="svc-chk">âœ“</div>
      <div class="svc-info">
        <div class="svc-name">${s.name}${s.req?'<span class="svc-req-dot"></span>':''}</div>
        <div class="svc-desc">${s.desc}</div>
        ${s.docs.length?`<div class="svc-docs">${docTags}</div>`:''}
      </div>
      <div>
        <div class="svc-price">\$${s.price}</div>
        <div class="svc-basis">/${s.basis==='cntr'?'cntr':s.basis==='bl'?'B/L':'ship'}</div>
      </div>
    </div>`;
  });
  html += '</div>';
  return html;
}

function renderServices() {
  let originHtml = '';
  ORIGIN_CATS.forEach(c => originHtml += renderServiceCat(c, 'origin-svc-body'));
  $('origin-svc-body').innerHTML = originHtml;

  let destHtml = '';
  DEST_CATS.forEach(c => destHtml += renderServiceCat(c, 'dest-svc-list'));
  $('dest-svc-list').innerHTML = destHtml;

  // Click handlers
  document.querySelectorAll('.svc[data-sid]').forEach(el => {
    el.addEventListener('click', () => {
      const sid = el.dataset.sid;
      const svc = S.services.find(s => s.id === sid);
      if (svc.req) return;
      svc.on = !svc.on;
      renderServices();
      renderDocs();
      recalc();
    });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FREE DAYS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderFreeDays() {
  let html = '';
  FREE_DAYS.forEach((fd, i) => {
    const isOn = fd.custom ? S.freeDaysCustom : (!S.freeDaysCustom && S.freeDays === fd.days);
    html += `<div class="fd-opt ${isOn?'on':''}" data-fdi="${i}">
      <div class="fd-num">${fd.custom?'âš™ï¸':fd.days}</div>
      <div class="fd-label">${fd.sub}</div>
      ${fd.costDay?`<div class="fd-cost">+\$${fd.costDay}/day</div>`:''}
    </div>`;
  });
  $('fd-grid').innerHTML = html;
  if (S.freeDaysCustom) show('fd-custom-wrap'); else hide('fd-custom-wrap');

  const cost = calcDetention();
  if (cost > 0) { $('fd-cost').textContent = `âš ï¸ Estimated extension cost: ${fmt(cost)}`; show('fd-cost'); }
  else hide('fd-cost');

  document.querySelectorAll('.fd-opt[data-fdi]').forEach(el => {
    el.addEventListener('click', () => {
      const fd = FREE_DAYS[parseInt(el.dataset.fdi)];
      if (fd.custom) { S.freeDaysCustom = true; }
      else { S.freeDaysCustom = false; S.freeDays = fd.days; }
      renderFreeDays();
      recalc();
    });
  });
}

function calcDetention() {
  const baseFree = S.selectedCarrier ? S.selectedCarrier.carrier.freeDest : 4;
  const days = S.freeDaysCustom ? (parseInt($('fd-custom')?.value)||10) : S.freeDays;
  if (days <= baseFree) return 0;
  const costDay = days > 7 ? 50 : 35;
  return (days - baseFree) * costDay;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CARRIERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function genCarrierQuotes() {
  if (!S.rateRange) return;
  const now = new Date();
  S.carrierQuotes = CARRIERS.slice(0, 10).map((c, i) => {
    const base = S.rateRange.min + Math.random() * (S.rateRange.max - S.rateRange.min);
    const baf = Math.round(base * 0.08);
    const caf = Math.round(base * 0.03);
    const pss = Math.round(base * 0.05);
    const total = Math.round(base + baf + caf + pss);
    const etd = addDays(now, 3 + i);
    const eta = addDays(etd, c.days);
    const avail = Math.random() > 0.3 ? 'Confirmed' : 'Subject';
    return {carrier: c, base: Math.round(base), surcharges:[{desc:'BAF',amt:baf},{desc:'CAF',amt:caf},{desc:'PSS',amt:pss}], total, etd, eta, avail};
  }).sort((a,b) => a.total - b.total);
}

function renderCarriers() {
  $('cr-count').textContent = `${S.carrierQuotes.length} carriers with capacity`;
  let html = '';
  S.carrierQuotes.forEach((q,i) => {
    const sel = S.selectedCarrier && S.selectedCarrier.carrier.id === q.carrier.id;
    const relCls = q.carrier.rel >= 90 ? 'high' : q.carrier.rel >= 85 ? 'medium' : 'low';
    const relColor = relCls==='high'?'var(--green)':relCls==='medium'?'var(--amber)':'var(--red)';
    html += `<div class="cr ${sel?'on':''}" data-cri="${i}">
      <div class="cr-logo">${q.carrier.code}</div>
      <div>
        <div class="cr-name">${q.carrier.name}${q.carrier.assured?'<span class="cr-badge">âœ“ Assured</span>':''}</div>
        <div class="cr-meta">
          <span>â±ï¸ ${q.carrier.days}d</span>
          <span>ğŸ“… ETD ${fmtDate(q.etd)}</span>
          <span>ğŸ“… ETA ${fmtDate(q.eta)}</span>
          <span><span style="display:inline-block;width:6px;height:6px;border-radius:50%;background:${relColor};vertical-align:middle"></span> ${q.carrier.rel}%</span>
        </div>
      </div>
      <div>
        <div class="cr-rate">${fmt(q.total)}</div>
        <div class="cr-per">per container</div>
        <div class="cr-avail ${q.avail==='Confirmed'?'yes':'maybe'}">${q.avail==='Confirmed'?'âœ“ Confirmed':'â³ Subject'}</div>
      </div>
    </div>`;
  });
  $('carrier-body').innerHTML = html;

  document.querySelectorAll('.cr[data-cri]').forEach(el => {
    el.addEventListener('click', () => {
      S.selectedCarrier = S.carrierQuotes[parseInt(el.dataset.cri)];
      renderCarriers();
      recalc();
    });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INSURANCE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function calcInsurance(val, type) {
  const rates = {Basic:0.003, Standard:0.005, Comprehensive:0.008};
  const deducts = {Basic:0.03, Standard:0.02, Comprehensive:0.01};
  const covAmt = val * 1.1;
  const prem = covAmt * rates[type];
  const ded = covAmt * deducts[type];
  const inclusions = {
    Basic:['Total Loss','General Average','Salvage'],
    Standard:['Total Loss','Partial Loss','General Average','Fire','Collision','Jettison'],
    Comprehensive:['All Risks','Theft','Contamination','Breakage','War/SRCC','Non-Delivery'],
  };
  const exclusions = {
    Basic:['Partial Loss','Delay','Inherent Vice','War'],
    Standard:['Delay','Inherent Vice','War','Leakage'],
    Comprehensive:['Delay','Inherent Vice','Nuclear'],
  };
  return {type, prem: Math.round(prem*100)/100, rate: rates[type]*100, covAmt: Math.round(covAmt), ded: Math.round(ded), inc: inclusions[type], exc: exclusions[type]};
}

function renderInsurance() {
  const val = parseFloat($('c-val')?.value) || 0;
  if (!S.insEnabled) { hide('ins-body'); return; }
  show('ins-body');

  if (val <= 0) {
    $('ins-body').innerHTML = '<div class="wv wrn mt-3"><span>âš ï¸</span><div>Enter cargo value to calculate premiums</div></div>';
    return;
  }

  const types = ['Basic','Standard','Comprehensive'];
  let html = '<div class="cov-grid">';
  types.forEach(t => {
    const q = calcInsurance(val, t);
    html += `<div class="cov-opt ${S.coverageType===t?'on':''}" data-cov="${t}">
      <div class="cov-name">${t}</div>
      <div class="cov-rate">${q.rate.toFixed(1)}% rate</div>
      <div class="cov-prem">${fmt(q.prem)}</div>
    </div>`;
  });
  html += '</div>';

  const q = calcInsurance(val, S.coverageType);
  html += `<div class="ins-detail mt-3">
    <div class="ins-stat">
      <div><div class="ins-stat-label">Coverage</div><div class="ins-stat-val">${fmt(q.covAmt)}</div></div>
      <div><div class="ins-stat-label">Deductible</div><div class="ins-stat-val" style="color:var(--text-0)">${fmt(q.ded)}</div></div>
      <div><div class="ins-stat-label">Premium</div><div class="ins-stat-val" style="color:var(--green)">${fmt(q.prem)}</div></div>
    </div>
    <div class="mt-3"><div class="fl mb-2">Inclusions</div><div class="ins-tags">${q.inc.map(i=>`<span class="ins-tag inc">âœ“ ${i}</span>`).join('')}</div></div>
    <div class="mt-3"><div class="fl mb-2">Exclusions</div><div class="ins-tags">${q.exc.map(e=>`<span class="ins-tag exc">âœ— ${e}</span>`).join('')}</div></div>
  </div>`;

  $('ins-body').innerHTML = html;

  document.querySelectorAll('.cov-opt[data-cov]').forEach(el => {
    el.addEventListener('click', () => {
      S.coverageType = el.dataset.cov;
      renderInsurance();
      recalc();
    });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DOCUMENTS & B/L
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderBL() {
  let html = '';
  BL_TYPES.forEach(bl => {
    html += `<div class="bl-opt ${S.blType===bl.type?'on':''}" data-bl="${bl.type}">
      <div class="bl-name">${bl.label}</div>
      <div class="bl-desc">${bl.desc}</div>
    </div>`;
  });
  $('bl-grid').innerHTML = html;
  document.querySelectorAll('.bl-opt[data-bl]').forEach(el => {
    el.addEventListener('click', () => { S.blType = el.dataset.bl; renderBL(); });
  });
}

function renderDocs() {
  const allDocs = new Set();
  S.services.filter(s=>s.on).forEach(s => s.docs.forEach(d => allDocs.add(d)));
  const configs = {
    'shipping-bill':{label:'Shipping Bill',req:true},
    'packing-list':{label:'Packing List',req:true},
    'commercial-invoice':{label:'Commercial Invoice',req:true},
    'bill-of-lading':{label:'Bill of Lading',req:true},
    'certificate-of-origin':{label:'Certificate of Origin',req:false},
    'fumigation':{label:'Fumigation Certificate',req:false},
  };
  const extras = [{name:'MSDS Certificate',req:false},{name:'Cargo Photos',req:false},{name:'Phytosanitary Certificate',req:false}];

  let html = '';
  if (allDocs.size > 0) {
    html += `<div class="fl mb-2">Document Status (${allDocs.size})</div>`;
    allDocs.forEach(d => {
      const c = configs[d] || {label:d, req:false};
      html += `<div class="doc-item">
        <div class="doc-dot pending"></div>
        <div class="doc-name">${c.label}</div>
        ${c.req?'<span class="doc-req">Required</span>':''}
        <div class="doc-status">Not Started</div>
      </div>`;
    });
  }
  html += `<div class="fl mb-2 mt-3">Additional Documents</div>`;
  extras.forEach(e => {
    html += `<div class="doc-item">
      <div class="doc-dot pending"></div>
      <div class="doc-name">${e.name}</div>
      <div class="doc-status" style="font-size:9px">Optional</div>
    </div>`;
  });
  $('doc-list').innerHTML = html;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRICE BREAKDOWN (SIDEBAR)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function recalc() {
  const qty = parseInt($('c-qty')?.value) || 1;
  S.qty = qty;
  S.containerSize = $('c-size')?.value || '20ft';
  S.containerType = $('c-type')?.value || 'Standard';
  S.cargoValue = parseFloat($('c-val')?.value) || 0;
  S.hsCode = $('c-hs')?.value || '';

  $('sb-spec').textContent = `${qty}Ã— ${S.containerSize} ${S.containerType}`;

  // Ocean freight
  const oceanRate = S.selectedCarrier ? S.selectedCarrier.total : 0;
  const oceanTotal = oceanRate * qty;

  // Origin charges
  const originSvcs = S.services.filter(s => s.cat.startsWith('origin') && s.on);
  const originCharges = originSvcs.map(s => ({name: s.name, amt: s.basis==='cntr'? s.price*qty : s.price}));
  const originTotal = originCharges.reduce((s,c)=>s+c.amt, 0);

  // Dest charges
  const destSvcs = S.services.filter(s => s.cat.startsWith('dest') && s.on);
  const destCharges = destSvcs.map(s => ({name: s.name, amt: s.basis==='cntr'? s.price*qty : s.price}));
  const detention = calcDetention();
  if (detention > 0) destCharges.push({name: `Free Days Extension`, amt: detention});
  const destTotal = destCharges.reduce((s,c)=>s+c.amt, 0);

  // Surcharges
  const surcharges = S.selectedCarrier ? S.selectedCarrier.surcharges.map(sc => ({name:sc.desc, amt:sc.amt*qty})) : [];
  const surTotal = surcharges.reduce((s,c)=>s+c.amt, 0);

  // Insurance
  let insPrem = 0;
  if (S.insEnabled && S.cargoValue > 0) {
    insPrem = calcInsurance(S.cargoValue, S.coverageType).prem;
  }

  const totalBefore = oceanTotal + originTotal + destTotal + surTotal + insPrem;

  // Incentives
  const incentives = [];
  if (S.hsCode && S.cargoValue > 0) {
    const ch = S.hsCode.substring(0,2);
    const rodtep = RODTEP[ch] || 1.5;
    incentives.push({type:'RoDTEP', amt: Math.round(S.cargoValue*(rodtep/100)*100)/100, pct:rodtep, note:`@ ${rodtep}% on FOB for HS ${ch}`});
    const gst = 18;
    incentives.push({type:'GST Refund', amt: Math.round(S.cargoValue*(gst/100)*0.9*100)/100, pct:gst, note:`IGST ${gst}% (90% ITC)`});
  }
  const totalIncentives = incentives.reduce((s,i)=>s+i.amt, 0);
  const netCost = totalBefore - totalIncentives;

  // Render sidebar
  let html = '';

  // Ocean
  if (oceanTotal > 0) {
    html += `<div class="sb-section"><div class="sb-title">Ocean Freight</div>
      <div class="sb-line"><span class="sb-label">Base + Surcharges Ã— ${qty}</span><span class="sb-amt">${fmt(oceanTotal)}</span></div></div>`;
  }

  // Origin
  if (originCharges.length) {
    html += `<div class="sb-section"><div class="sb-title">Origin Charges</div>`;
    originCharges.forEach(c => html += `<div class="sb-line"><span class="sb-label">${c.name}</span><span class="sb-amt">${fmt(c.amt)}</span></div>`);
    html += `<div class="sb-line sub"><span class="sb-label">Subtotal</span><span class="sb-amt">${fmt(originTotal)}</span></div></div>`;
  }

  // Destination
  if (destCharges.length) {
    html += `<div class="sb-section"><div class="sb-title">Destination Charges</div>`;
    destCharges.forEach(c => html += `<div class="sb-line"><span class="sb-label">${c.name}</span><span class="sb-amt">${fmt(c.amt)}</span></div>`);
    html += `<div class="sb-line sub"><span class="sb-label">Subtotal</span><span class="sb-amt">${fmt(destTotal)}</span></div></div>`;
  }

  // Surcharges
  if (surcharges.length) {
    html += `<div class="sb-section"><div class="sb-title">Carrier Surcharges</div>`;
    surcharges.forEach(c => html += `<div class="sb-line"><span class="sb-label">${c.name}</span><span class="sb-amt">${fmt(c.amt)}</span></div>`);
    html += `<div class="sb-line sub"><span class="sb-label">Subtotal</span><span class="sb-amt">${fmt(surTotal)}</span></div></div>`;
  }

  // Insurance
  if (insPrem > 0) {
    html += `<div class="sb-section"><div class="sb-title">Insurance</div>
      <div class="sb-line"><span class="sb-label">ğŸ›¡ï¸ ${S.coverageType}</span><span class="sb-amt">${fmt(insPrem)}</span></div></div>`;
  }

  // Incentives
  if (incentives.length) {
    html += `<div class="sb-section"><div class="sb-title">ğŸ“Š Estimated Incentives</div>`;
    incentives.forEach(inc => {
      html += `<div class="sb-incent">
        <div><div class="sb-incent-type">${inc.type}</div><div class="sb-incent-note">${inc.note}</div></div>
        <div class="sb-incent-amt">-${fmt(inc.amt)}</div>
      </div>`;
    });
    html += '</div>';
  }

  $('sb-content').innerHTML = html || `<div class="sb-section" style="text-align:center;padding:40px 16px"><div style="font-size:28px;margin-bottom:8px">ğŸ’°</div><div style="font:400 11px var(--sans);color:var(--text-2)">Configure your shipment to see<br>the total landing cost</div></div>`;

  // Total
  if (totalBefore > 0) {
    $('sb-total-val').textContent = fmt(totalBefore);
    if (totalIncentives > 0) {
      $('sb-net').textContent = `Net after incentives: ${fmt(netCost)}`;
      show('sb-net');
    } else {
      hide('sb-net');
    }
    show('sb-total');
  } else {
    hide('sb-total');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function init() {
  // Clock
  function tick() { $('clock').textContent = new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',second:'2-digit'}); }
  tick(); setInterval(tick, 1000);

  // Port selectors
  initPortSelector('origin-input','origin-dd','origin');
  initPortSelector('dest-input','dest-dd','dest');

  // Search button
  $('btn-search').addEventListener('click', doSearch);

  // Cargo listeners
  ['c-size','c-type','c-qty','c-wt','c-wt-unit','c-hs','c-val','c-comm'].forEach(id => {
    const el = $(id);
    if (!el) return;
    el.addEventListener('change', () => { validateWeight(); recalc(); renderInsurance(); });
    el.addEventListener('input', () => { validateWeight(); recalc(); });
  });

  // Insurance toggle
  $('ins-toggle').addEventListener('click', () => {
    S.insEnabled = !S.insEnabled;
    $('ins-tog').classList.toggle('on', S.insEnabled);
    $('ins-toggle').classList.toggle('on', S.insEnabled);
    renderInsurance();
    recalc();
  });

  // Free days custom
  $('fd-custom')?.addEventListener('input', () => { renderFreeDays(); recalc(); });

  // Book button
  $('btn-book').addEventListener('click', () => {
    alert('Booking submitted! ğŸ‰\n\nThis is a demo â€” in production this would create a live booking.');
  });
}

document.addEventListener('DOMContentLoaded', init);
</script>
</body>
</html>
